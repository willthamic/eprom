<!DOCTYPE html>
<html lang="en">
	<head>
		<title>ACE in Action</title>
		<style type="text/css" media="screen">

			html, body, div {
				margin:0;
				padding:0;
			}

			.container {
				display: flex;
				width:100vw;
				height:100vh;
			}

			.editor {
				width:50%;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="editor" id="editorL"></div>
			<div class="editor" id="editorR"></div>
		</div>

		<script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>
		<script>
			var editorL = ace.edit("editorL");
			editorL.setTheme("ace/theme/monokai");
			editorL.session.setMode("ace/mode/javascript");
			
			var editorR = ace.edit("editorR");
			editorR.setTheme("ace/theme/monokai");
			editorR.session.setMode("ace/mode/vhdl");
			editorR.setOptions({
				readOnly: true,
				highlightActiveLine: false,
				highlightGutterLine: false
			})
			editorR.renderer.$cursorLayer.element.style.opacity=0;

			editorL.session.on('change', function(delta) {
				var start = '---2019 BIN-TO-VHD CONVERTER 1.0\n---Copyright William D. Richard, Ph.D.\n\nLIBRARY IEEE ;\nUSE IEEE.STD_LOGIC_1164.ALL ;\nUSE IEEE.STD_LOGIC_ARITH.ALL;\n\nENTITY eprom IS\n   PORT (d        : OUT STD_LOGIC_VECTOR(31 DOWNTO 0) ;\n         address  : IN  STD_LOGIC_VECTOR(9 DOWNTO 0) ;\n         ce_l     : IN  STD_LOGIC ;\n         oe_l     : IN  STD_LOGIC) ;\n   END eprom ;\n\nARCHITECTURE behavioral OF eprom IS\n\n   SIGNAL data    : STD_LOGIC_VECTOR(31 DOWNTO 0) ;\n   SIGNAL sel     : STD_LOGIC_VECTOR(31 DOWNTO 0) ;\n\nBEGIN\n\n   sel <= "00000000000000000000" & address & "00" ;\n\n   WITH sel  SELECT\n   data <=\n';
				var end = '      X"00000000" WHEN OTHERS ;\n\nreadprocess:PROCESS(ce_l,oe_l,data)\nbegin\n   IF (ce_l = \'0\' AND oe_l = \'0\') THEN\n	  d(31 DOWNTO 0) <= data ;\n   else\n  d(31 DOWNTO 0) <= (OTHERS => \'Z\') ;\n   END IF;\nEND PROCESS readprocess ;\nEND behavioral ;'

				var content = evalRight();
				if (content == "") {
					editorR.setValue("");
					return;
				}
				editorR.setValue(start + content + end);
			});

			function evalRight() {
				var hex8 = /[0-9A-F]{8}/g;
				var content = "";
				for (var i = 1; i < editorL.session.getLength(); i++) {
					var line = editorL.session.getLine(i);
					var hex = line.match(hex8);
					if (hex != null && hex.length == 2) {
						content += '      X"' + hex[1] + '" WHEN X"' + hex[0] + '" ,\n';
					}
				}
				return content;
			}

		</script>
	</body>
</html>
